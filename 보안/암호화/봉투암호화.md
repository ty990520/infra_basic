# 봉투 암호화

### 1. 봉투 암호화(Envelope Encryption)의 개념

봉투 암호화는 데이터를 보호하기 위해 두 가지 키를 사용하는 암호화 방법입니다. "데이터 키"를 사용하여 실제 데이터를 암호화하고, "마스터 키"를 사용하여 데이터 키 자체를 암호화합니다. 데이터 키는 각 데이터 덩어리마다 고유하게 생성되며, 마스터 키는 별도의 안전한 위치에 저장됩니다.

<br>

### 2. 봉투 암호화의 목적
- **보안성 향상:**
  - 데이터와 데이터 키를 분리하여 관리함으로써, 데이터 키가 유출되더라도 마스터 키가 보호되어 있으면 데이터를 복호화할 수 없습니다.
  - 마찬가지로 마스터 키가 유출되더라도 각 데이터에 대한 데이터 키가 다르므로, 전체 데이터가 위험에 노출되지 않습니다.

- **효율적인 키 관리:**
  - 각 데이터 덩어리마다 고유한 데이터 키를 생성하여 관리하므로, 키의 수명 주기를 보다 쉽게 관리할 수 있습니다.
  - 데이터 키의 갱신 또는 교체가 필요할 경우, 마스터 키를 사용하여 데이터 키를 쉽게 갱신할 수 있습니다.

- **비용 절감:**
  - AWS KMS는 CMK의 사용 횟수에 따라 비용이 발생하며, 각 CMK의 사용 횟수에는 제한이 있습니다.
  - 대량의 데이터를 직접 CMK로 암호화하게 되면, 비용이 증가하고 CMK의 사용 제한에 빠르게 도달할 수 있습니다.
  - 봉투 암호화를 사용하면, 데이터 키를 이용하여 데이터를 암호화하고, 데이터 키만 CMK로 암호화하여 저장함으로써 CMK의 사용 횟수와 비용을 절약할 수 있습니다.

<br>

### 3. 봉투 암호화의 구체적인 사용 사례

- **데이터베이스 환경에서의 봉투 암호화:**
  1. 사용자의 개인 정보를 암호화하는 데 사용할 데이터 키를 생성합니다.
  2. 생성된 데이터 키로 사용자의 개인 정보를 암호화하여 데이터베이스에 저장합니다.
  3. 데이터 키 자체는 마스터 키를 사용하여 암호화합니다. 마스터 키는 별도의 안전한 위치에 저장됩니다.
  4. 사용자의 개인 정보를 복호화하려면, 먼저 마스터 키를 이용하여 데이터 키를 복호화합니다.
  5. 복호화된 데이터 키로 사용자의 개인 정보를 복호화하여 사용합니다.


- **AWS 환경에서의 봉투 암호화:**
  1. S3에 저장된 데이터는 SSE-S3(데이터키)을 사용하여 암호화됩니다.
  2. 데이터를 암호화하는 키는 AWS Key Management Service (KMS)에서 관리되는 CMK(마스터키)를 이용해 암호화됩니다.
  3. 사용자가 데이터를 복호화하려고 할 때, KMS에서 관리되는 CMK를 이용해 데이터 키를 복호화한 후, 그 키를 이용해 저장된 데이터를 복호화합니다.

- **위의 과정에서 데이터키가 SSE-KMS인 경우**
![IMAGE](https://image.slidesharecdn.com/3003-200330034411/75/aws-kms-aws-aws-builders-300-21-2048.jpg?cb=1666645952)
KMS를 통한 세밀한 키 관리 및 권한 부여가 필요한 경우에 적합


<br>
 
---

**헷갈린 부분:**
- 봉투 암호화는 데이터베이스의 패스워드나 리소스의 자격증명을 암호화하는 것이 아닙니다. 그 대신, 데이터베이스 내부에 저장된 사용자의 개인 정보와 같은 중요한 데이터 자체를 암호화합니다. 
  - 데이터베이스의 패스워드나 리소스의 자격증명은 일반적으로 암호화의 대상이 될 수 있지만, 봉투 암호화의 주된 목적은 중요한 데이터를 보호하는 것입니다.
  - 데이터베이스 내의 중요한 데이터는 "데이터 키"로 암호화되며, 이 데이터 키 자체도 "마스터 키"로 다시 암호화되어 보호됩니다.

---

이미지 출처 : https://www.slideshare.net/awskorea/aws-kms-aws-aws-builders-300
